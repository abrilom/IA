---
- name: Instalar Apache en Ubuntu y configurar para puerto 8080
  hosts: all
  become: true
  tasks:
    - name: 1. Instalar el paquete Apache
      ansible.builtin.apt:
        name: apache2
        state: present
        update_cache: yes

    - name: 2. Configurar ports.conf de Apache para escuchar en el puerto 8080
      ansible.builtin.replace:
        path: /etc/apache2/ports.conf
        regexp: '^\s*Listen 80\s*$'
        replace: 'Listen 8080'
        owner: root
        group: root
        mode: '0644'

    - name: 2. Configurar el host virtual predeterminado para usar el puerto 8080
      ansible.builtin.replace:
        path: /etc/apache2/sites-available/000-default.conf
        regexp: '^\s*<VirtualHost \*:80>\s*$'
        replace: '<VirtualHost *:8080>'
        owner: root
        group: root
        mode: '0644'

    - name: 2. Asegurar que el sitio predeterminado est√© habilitado (crear symlink)
      ansible.builtin.file:
        src: /etc/apache2/sites-available/000-default.conf
        dest: /etc/apache2/sites-enabled/000-default.conf
        state: link
        owner: root
        group: root
        mode: '0644'
